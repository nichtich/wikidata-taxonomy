!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).wdt=e()}}(function(){return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=r[a]={exports:{}};t[a][0].call(p.exports,function(e){var r=t[a][1][e];return i(r||e)},p,p.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){"use strict";function n(e){return e.reduce(function(e,t){return e[t.uri]=t,e},{})}function i(e,t){if(t in e)return t;for(var r in e)return r;return"en"}t.exports={getPrefLabel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=e.prefLabel||{};return(t=i(n,t))in n?n[t]:r},getScopeNotes:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en";return t=n,r=e["scopeNote"]||{},(t=i(r,t))in r?r[t]:[]},getOccurrenceCount:function(e,t){return((e||[]).find(function(e){for(var r in t)if(e[r]!==t[r])return!1;return!0})||{}).count||0},traverseConcepts:function(e,t){if(!e.concepts)return;var r=n(e.concepts),i=[];(e.topConcepts||[]).forEach(function(e){return function e(n,o,a){var s=r[n];if(!s)return;if(t(s,o,i[n],a),!i[n]){i[n]=!0;var u=s.subjectOf||[];u.forEach(function(t){return e(t.uri,o+1,!0)});var c=s.narrower||[];c.forEach(function(t){return e(t.uri,o+1,!1)})}}(e.uri,0,!1)})},setMap:n,pruneHierarchy:function(e,t){var r=n(e.concepts);if("function"!=typeof t){var i=t.split(",").map(function(e){if(o[e])return o[e];throw new Error("Don't know how to prune by "+e)});if(!i.length)return;t=function(e){return i.some(function(t){return t(e)})}}var a={};(e.topConcepts||[]).forEach(function(e){a[e.uri]=!0});e.concepts.forEach(function(e){e&&e.uri&&!a[e.uri]&&t(e)&&(a[e.uri]=!0,function e(t){t&&t.broader&&t.broader.forEach(function(t){a[t.uri]||(a[t.uri]=!0,e(r[t.uri]))})}(e))}),e.concepts=e.concepts.filter(function(e){if(a[e.uri])return e.narrower&&(e.narrower=e.narrower.filter(function(e){return a[e.uri]})),e.broader&&(e.broader=e.broader.filter(function(e){return a[e.uri]})),e.subjectOf&&(e.subjectOf=e.subjectOf.filter(function(e){return a[e.uri]})),!0})}};var o={mappings:function(e){return e.mappings&&e.mappings.length},occurrences:function(e){return e.occurrences&&e.occurrences.length},instances:function(e){return e.occurrences&&e.occurrences.some(function(e){return"http://www.wikidata.org/entity/P31"===e.relation})},sites:function(e){return e.occurrences&&e.occurrences.some(function(e){return"http://schema.org/about"===e.relation})}}},{}],2:[function(e,t,r){"use strict";var n={P1628:["http://www.w3.org/2004/02/skos/core#exactMatch","http://www.w3.org/2002/07/owl#equivalentProperty"],P1709:["http://www.w3.org/2004/02/skos/core#exactMatch","http://www.w3.org/2002/07/owl#equivalentClass"],P2888:["http://www.w3.org/2004/02/skos/core#exactMatch","http://schema.org/sameAs"],P3950:["http://www.w3.org/2004/02/skos/core#narrowMatch"],P2236:["http://www.w3.org/2004/02/skos/core#narrowMatch"],P2235:["http://www.w3.org/2004/02/skos/core#broadMatch","http://www.w3.org/2000/01/rdf-schema#subPropertyOf"]};t.exports={shortcuts:{equal:"P1628,P1709,P2888","=":"P1628,P1709,P2888",all:"P1628,P1709,P2888,P2235,P2236,P3950",narrower:"P3950,P2236",broader:"P2235",class:"P1709,P2888,P3950",property:"P1628,P2235,P2236"},equivalences:n,mappingChars:{"http://www.w3.org/2004/02/skos/core#exactMatch":"=","http://www.w3.org/2004/02/skos/core#narrowMatch":">","http://www.w3.org/2004/02/skos/core#broadMatch":"<","http://www.w3.org/2004/02/skos/core#mappingRelation":"≈"},equivalentTypes:function(e){return(e in n?n[e]:["http://www.w3.org/2004/02/skos/core#mappingRelation"]).concat(["http://www.wikidata.org/entity/"+e])}}},{}],3:[function(e,t,r){"use strict";var n=e("./mappings").shortcuts;t.exports=function(e){if((e=e||{}).language=e.language||e.lang||"en",e.property=e.property||["P279","P31"],e.endpoint=e.endpoint||"https://query.wikidata.org/sparql",e.labels=!1!==e.labels,e.instances&&(e.instancecount=!1),e.instances&&e.reverse)throw new Error("option instances and reverse cannot be specified together");return e.mappings in n&&(e.mappings=n[e.mappings]),"string"==typeof e.mappings&&(e.mappings=e.mappings.split(",")),e.mappings&&!e.mappings.length&&(e.mappings=null),e}},{"./mappings":2}],4:[function(e,t,r){(function(r){"use strict";var n="undefined"!=typeof window?window.wdk:void 0!==r?r.wdk:null,i=e("./sparql"),o=e("./options"),a=e("./utils"),s=a.pushArrayField,u=a.values,c=e("./request"),p=e("./transform"),f=p.itemFromRow,l=p.addMapping;function w(e,t,r){var n={};t[0].forEach(function(e){var t="http://www.wikidata.org/entity/"+e.item.value;if(!n[t]){var i=f(e,r.language);e.instances&&s(i,"occurrences",{relation:"http://www.wikidata.org/entity/P31",count:e.instances}),e.sites&&s(i,"occurrences",{relation:"http://schema.org/about",count:e.sites}),n[t]=i}var o=n[t];if(l(o,e.mapping,e.mappingProperty),e.broader){o.broader||(o.broader=[]);var a="http://www.wikidata.org/entity/"+e.broader;o.broader.find(function(e){return e.uri===a})||o.broader.push({uri:a})}});var i=function(e){(n[e].broader||[]).forEach(function(t){n[t.uri]&&s(n[t.uri],"narrower",{uri:e})})};for(var o in n)i(o);t[1]&&t[1].forEach(function(e){var t="http://www.wikidata.org/entity/"+e.class.value,i=e.item.value,o=f(e,r.language);n[o.uri]||(n[o.uri]=o),l(o,e.mapping,e.mappingProperty),n[t]&&s(n[t],"subjectOf",{uri:"http://www.wikidata.org/entity/"+i})});for(var o in n)for(var a=n[o],c=["narrower","broader","subjectOf"],p=0;p<c.length;p++){var w=c[p];a[w]&&(a[w]=a[w].sort(function(e,t){return e.uri.substr(e.uri.lastIndexOf("/")+2)-t.uri.substr(t.uri.lastIndexOf("/")+2)}))}return r.reverse&&u(n).forEach(function(e){var t=[e.narrower,e.broader];e.broader=t[0],e.narrower=t[1]}),{type:["http://www.w3.org/2004/02/skos/core#ConceptScheme"],modified:(new Date).toISOString(),license:[{uri:"http://creativecommons.org/publicdomain/zero/1.0/",notation:["CC0"]}],languages:[r.language],topConcepts:[{uri:"http://www.wikidata.org/entity/"+e}],concepts:u(n)}}t.exports=function(e,t){try{t=o(t)}catch(e){return Promise.reject(e)}var r=i(e,t),a=n.simplifySparqlResults;return Promise.all(r.map(function(e){return c(e,t).then(a).then(function(e){return e.map(function(e){return["item","class"].forEach(function(t){"string"==typeof e[t]&&(e[t]={value:e[t]})}),e})})})).catch(function(e){throw new Error("SPARQL request failed")}).then(function(r){if(!(1!==r[0].length||r[1]&&r[1].length)){var n=r[0][0];if(n.item.label===e&&!n.broader&&!n.instances&&!n.sites)return c("SELECT * WHERE { wd:"+e+" ?p ?v } LIMIT 1",t).catch(function(e){throw new Error("SPARQL request failed")}).then(function(n){return n.length?w(e,r,t):null})}return w(e,r,t)}).then(function(t){if(!t)throw new Error(e+" not found");return t})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./options":3,"./request":5,"./sparql":13,"./transform":14,"./utils":15}],5:[function(e,t,r){(function(e){"use strict";var r="undefined"!=typeof window?window.requestPromise:void 0!==e?e.requestPromise:null;t.exports=function(e,t){var n={uri:t.endpoint,method:t.post?"POST":"GET",qs:{format:"json",query:e}};return(t.user||t.password)&&(n.auth={},t.user&&(n.auth.user=t.user),t.password&&(n.auth.password=t.password)),r(n)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,r){"use strict";var n=e("./serialize-sv"),i=e("./jskos").traverseConcepts;t.exports=function(e,t,r){r.languages=e.languages,i(e,function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t.write(n.apply(void 0,i.concat([r,",",JSON.stringify])))})}},{"./jskos":1,"./serialize-sv":9}],7:[function(e,t,r){"use strict";t.exports=function(e,t){t.write(JSON.stringify(e,null,2)+"\n")}},{}],8:[function(e,t,r){"use strict";var n=e("./jskos").traverseConcepts;t.exports=function(e,t){n(e,function(e,r,n){n||t.write(JSON.stringify(e)+"\n")})}},{"./jskos":1}],9:[function(e,t,r){"use strict";var n=e("./jskos"),i=n.getPrefLabel,o=n.getOccurrenceCount;t.exports=function(e,t,r,n,a,s,u){var c=a.chalk,p=c.delimiter,f=i(e,a.languages[0]);u&&(f=u(f));var l="";if(!t){var w=["level","id","label"];a.sitecount&&w.push("sites"),a.instancecount&&w.push("instances"),w.push("parents"),l+=w.join(p(","))+"\n"}var g=[p((e.visited?"=":"-").repeat(t)),c.green(a.uris?e.uri:e.notation[0]),n?c.cyan(f):c.white(f)];a.sitecount&&g.push(c.yellow(o(e.occurrences,{relation:"http://schema.org/about"}))),a.instancecount&&g.push(c.cyan(o(e.occurrences,{relation:"http://www.wikidata.org/entity/P31"})));var d=e.broader?e.broader.length:0,h=d?"^".repeat(d-(t?1:0)):"";return g.push(c.red(h)),l+=g.join(p(s))+"\n"}},{"./jskos":1}],10:[function(e,t,r){"use strict";var n=e("./serialize-sv"),i=e("./jskos").traverseConcepts;t.exports=function(e,t,r){r.languages=e.languages,i(e,function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return t.write(n.apply(void 0,i.concat([r,"\t"])))})}},{"./jskos":1,"./serialize-sv":9}],11:[function(e,t,r){"use strict";var n=e("./jskos"),i=n.getPrefLabel,o=n.getScopeNotes,a=n.getOccurrenceCount,s=n.setMap,u=e("../lib/mappings").mappingChars;function c(e,t){var r=t.chalk;return(e||[]).map(function(e){return" "+r.dim(u[e.type[0]])+r.green(e.to.memberSet[0].uri)}).join("")}t.exports=function(e,t,r){if(e.topConcepts&&e.concepts){var n=s(e.concepts);e.topConcepts.forEach(function(s){t.write(function e(t,r,n,s,u){var p=r[n];if(!p)return"\n";var f=u.chalk;var l=f.delimiter;var w=i(p,t.languages[0],"???");var g=p.broader||[];var d=n===t.topConcepts[0].uri||!g.length;var h="↑".repeat(g.length-(d?0:1));h=h?" "+h:"";var m=p.narrower||[];var v=p.visited+m.length?" …":p.multi>1?"=":"";var b="Q"===n.substr(0,1)&&!s&&!p.subjectOf&&g.length<=1&&!m.length?"cyan":"white";var y=u.uris?n:p.notation[0];var P=f[b](w)+l(" (")+f.green(y)+l(")");if(u.sitecount){var k=a(p.occurrences,{relation:"http://schema.org/about"});k&&(P+=f.yellow(" •"+k))}if(u.instancecount&&!p.subjectOf){var E=a(p.occurrences,{relation:"http://www.wikidata.org/entity/P31"});E&&(P+=f.cyan(" ×"+E))}P+=f.red(h+v)+c(p.mappings,u)+"\n";if(p.visited)return P;p.visited=!0;var O=o(p,t.languages[0]);O.length&&(P+=l(s),m.length&&(P+=l("│ ")),P+=O[0]+"\n");if(p.subjectOf)for(var j=0;j<p.subjectOf.length;j++){var x=r[p.subjectOf[j].uri],C=i(x,t.languages[0],"???"),q=u.uris?x.uri:x.notation[0],L=m.length?"|":" ";P+=l(s+L)+l(x.visited?"=":"-")+f.cyan(C)+l(" (")+f.green(q)+l(")")+c(x.mappings,u)+"\n",x.scopeNote&&(P+=L+" "+x.scopeNote[t.language]+"\n"),x.visited=!0}for(var S=0;S<m.length;S++){var N=m[S].uri,T=S===m.length-1;if(r[N]){var I=r[N].visited?T?"╘══":"╞══":T?"└──":"├──";P+=l(s+I),P+=e(t,r,N,s+(T?"   ":"│  "),u)}}return P}(e,n,s.uri,"",r))})}}},{"../lib/mappings":2,"./jskos":1}],12:[function(e,t,r){"use strict";t.exports={json:e("./serialize-json"),ndjson:e("./serialize-ndjson"),csv:e("./serialize-csv"),tsv:e("./serialize-tsv"),txt:e("./serialize-txt")},t.exports.tree=t.exports.text},{"./serialize-csv":6,"./serialize-json":7,"./serialize-ndjson":8,"./serialize-tsv":10,"./serialize-txt":11}],13:[function(e,t,r){"use strict";var n=e("./options");function i(e,t,r,n){return n.labels&&(r+='\n    SERVICE wikibase:label {\n      bd:serviceParam wikibase:language "'+n.language+'"\n    }'),"  SELECT "+e+" WITH {\n    "+t+"\n  } AS %items WHERE { \n    INCLUDE %items ."+r+"\n  }"}function o(e){return"\n      SELECT ?item ?mapping ?mappingProperty {\n        INCLUDE %items .\n        OPTIONAL {\n          "+(e=e.map(function(e){return"{ ?item wdt:"+e+" ?mapping . BIND('"+e+"' AS ?mappingProperty) }"}).join(" UNION\n          "))+"\n        }\n      }"}t.exports=function(e,t){var r=[function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.property,n=t.children?"?":"*",a="SELECT DISTINCT ?item { "+(t.reverse?"wd:"+e+" wdt:"+r[0]+n+" ?item":"?item wdt:"+r[0]+n+" wd:"+e)+" }",s="?item ?broader";!1!==t.labels&&(s+=" ?itemLabel",t.description&&(s+=" ?itemDescription"));var u="\n    OPTIONAL { ?item wdt:"+r[0]+" ?broader } .",c=[];if(t.instancecount){var p=t.total?"/wdt:"+r[0]+"*":"";s+=" ?instances",c.push("\n      SELECT ?item (count(distinct ?element) as ?instances) {\n        INCLUDE %items.\n        OPTIONAL { ?element wdt:"+r[1]+p+" ?item }\n      } GROUP BY ?item")}t.sitecount&&(s+=" ?sites",c.push("\n      SELECT ?item (count(distinct ?site) as ?sites) {\n        INCLUDE %items.\n        OPTIONAL { ?site schema:about ?item }\n      } GROUP BY ?item"));t.mappings&&(s+=" ?mapping ?mappingProperty",c.push(o(t.mappings)));return u+=c.map(function(e){return"\n    {"+e+"\n    }"}).join(""),i(s,a,u,t)}(e,t=n(t))];return t.instances&&r.push(function(e,t){var r="?class ?item";!1!==t.labels&&(r+=" ?classLabel ?itemLabel",t.description&&(r+=" ?itemDescription"));var n="";t.mappings&&(r+=" ?mapping ?mappingProperty",n+="\n    { "+o(t.mappings)+"\n    }");var a="SELECT ?class ?item {\n      ?class wdt:"+t.property[0]+"* wd:"+e+" .\n      ?item wdt:"+t.property[1]+" ?class .\n    }";return i(r,a,n,t)}(e,t)),r}},{"./options":3}],14:[function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var i=e("./mappings").equivalentTypes;t.exports={itemFromRow:function(e,t){var r={uri:"http://www.wikidata.org/entity/"+e.item.value,notation:[e.item.value]};return e.item.label&&e.item.label!==e.item.value&&(r.prefLabel=n({},t,e.item.label)),e.itemDescription&&(r.scopeNote=n({},t,[e.itemDescription])),r},addMapping:function(e,t,r){t&&(e.mappings||(e.mappings=[]),e.mappings.find(function(e){return e.to.memberSet[0].uri===t&&e.type[e.type.length-1]==="http://www.wikidata.org/entity/"+r})||e.mappings.push({from:{memberSet:[{uri:e.uri}]},to:{memberSet:[{uri:t}]},type:i(r)}))}}},{"./mappings":2}],15:[function(e,t,r){"use strict";t.exports={pushArrayField:function(e,t,r){e[t]=e[t]||[],e[t].push(r)},values:function(e){return Object.keys(e).map(function(t){return e[t]})}}},{}],16:[function(e,t,r){"use strict";t.exports={serializeTaxonomy:e("./lib/serialize"),queryTaxonomy:e("./lib/query"),sparqlQueries:e("./lib/sparql")}},{"./lib/query":4,"./lib/serialize":12,"./lib/sparql":13}]},{},[16])(16)});